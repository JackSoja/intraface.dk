<?xml version="1.0" ?>
<project name="intraface" default="build" basedir=".">
    <property name="source.dir" value="./" />
    <property name="tests.dir" value="./tests/unit/" />
    <property name="build.dir" value="../build" />
    <property name="reports.dir" value="../build/logs" />
    <property name="reports.phpunit.dir" value="../../../build/logs" />
    <property name="reports.coverage.dir" value="../../../build/coverage" />
    <property name="api.dir" value="../build/api" />

    <target name="prepare">
        <delete dir="${build.dir}" />
    </target>

    <target name="build" depends="prepare,checkout,test,php-codesniffer,php-documentor,pear-create">
    </target>

    <target name="checkout">
        <exec dir="${source.dir}" command="svn export ${source.dir} ${build.dir}" />
    </target>

    <target name="test">
        <exec dir="${tests.dir}" command="phpunit
           --log-xml ${reports.phpunit.dir}/phpunit.xml
           --log-pmd ${reports.phpunit.dir}/phpunit.pmd.xml
           --log-metrics ${reports.phpunit.dir}/phpunit.metrics.xml 	
           --coverage-xml ${reports.phpunit.dir}/phpunit.coverage.xml
           --coverage-html ${reports.coverage.dir}/
           AllTests" passthru="true" checkreturn="false" />
    </target>

    <target name="php-codesniffer">
        <exec output="${reports.dir}/checkstyle.xml" dir="${source.dir}Intraface/"
            command="phpcs --report=checkstyle . --standard=PEAR" />
    </target>

    <target name="php-documentor">
        <exec dir="${source.dir}" command="phpdoc -ue on -t ${api.dir} -d ${source.dir}/Intraface" />
    </target>

    <target name="pear">
        <exec dir="${build.dir}" command="php generate_package_xml.php make" />
    </target>

    <target name="pear-create">
        <phingcall target="pear" />
        <exec dir="${build.dir}" command="pear package package.xml" />
    </target>

    <target name="deploy">
        <property file="./build.properties" />
    </target>

</project>